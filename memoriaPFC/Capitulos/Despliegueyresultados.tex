\chapter{Despliegue y resultados}
\label{CAP:Despliegueyresultados}
A lo largo del desarrollo del proyecto, todo el trabajo ha caído sobre mi, pero llegados a este punto los auténticos protagonistas son los usuarios, los alumnos de la ETSIT, tanto los que han disfrutado de un programa Erasmus como los que no. Y aquí es donde su opinión cuenta, ya que serán ellos quienes hagan uso de la aplicación. Este penúltimo apartado lo dedicaremos a la explicación de los distintos pasos llevados a cabo para realizar debidamente el despliegue y las pruebas de la aplicación web.\\
 
\section{Despliegue de la aplicación}
\label{SEC:Seccion41}
Para llegar al funcionamiento deseado de la aplicación se han realizado diversas pruebas tanto internas como externas y con una dimensión mayor de usuarios. Para las pruebas externas se han realizado de distinta manera.\\

\subsection{Primera prueba: Servidor local}
A la vez que se va implementando todo el código de la aplicación, se van ejecutando una serie de pruebas, para ir depurando pequeños bloques de funcionalidades. Estas pruebas se realizan lanzando un servidor local con el que podemos simular una navegación por internet. El navegador lanzará peticiones HTTP al servidor, el cuál irá mostrándole la información que el cliente le pida.\\

En primer lugar, para poder observar correr una página Django con el servidor de pruebas sin la necesidad de levantar un servidor \textit{Apache} y configurarlo con \textit{Python}, basta con ejecutar la siguiente línea en una \textbf{shell Unix} \textit{manage.py runserver}. Si no se le indica ninguna IP ni puerto al lanzar el servidor de python, dicho servidor se ata a la IP local (\textit{localhost} o 127.0.0.1) y a un puerto cualquiera, que por defecto python toma el puerto de escucha 8000.\\

En la figura \textbf{\ref{fig:svdlocaldjango}} vemos una \textit{Shell Unix} donde está lanzado el servidor \textit{Django} con IP localhost y puerto por defecto.

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/runserverLocalhost.png}
	\caption{Lanzado el servidor de Django con la IP localhost y un puerto cualquiera.}
	\label{fig:svdlocaldjango}
	
\end{figure}

Para probar la aplicación web desde un navegador cargamos la siguiente url: \textit{127.0.0.1:8000/tuerasmus}. En la figura \textbf{\ref{fig:navlocaldjango}} vemos lo que devuelve el servidor cuando cargamos esta url.

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/navLocalhost.png}
	\caption{Navegador realizando una petición GET de ``TuErasmus'' al servidor.}
	\label{fig:navlocaldjango}
	
\end{figure}

Con estas pruebas, servidor local, se ha depurado más del 80\% del código. Pudiendo avanzar con el desarrollo de la aplicación, y poder realizar las pautas necesarias para las siguientes pruebas del despliegue de la herramienta web.\\

\subsection{Segunda prueba: Servidor local con acceso a Internet}
Esta segunda prueba, que consideramos el primer despliegue con unas dimensiones mayores, en cuanto a usuarios, de la aplicación fue el momento clave para saber si a los usuarios les resultaban útiles o no algunas de las funcionalidades de la aplicación web.\\

En esta ocasión se pretendía lanzar el propio servidor que venía instalado con \textit{Django}, pero abriendo un puerto a Internet, es decir, poder llegar a este servidor desde cualquier máquina ajena a nuestra red dom\'stica (o LAN). Para ello al lanzar el servidor de \textit{Django} debemos indicarle el puerto y la IP en las que el servidor estará escuchando. En una \textbf{shell Unix} ejecutamos \textit{manage.py runserver 192.168.1.129:8000}. En la figura \textbf{\ref{fig:svdprivdjango}} se muestra un servidor \textit{Django} lanzado con IP privada y un puerto cualquiera.\\

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/runserverIPPrivada.png}
	\caption{Lanzado el servidor de Django con la IP privada y un puerto cualquiera.}
	\label{fig:svdprivdjango}
	
\end{figure}

Para acceder a la aplicación desde un PC o un dispositivo conectado a la LAN de casa o a la WiFi de casa la URL que hay que poner en el navegador es \textit{192.168.1.129:8000/tuerasmus}. En cambio, para acceder a la aplicación web desde un PC o dispositivo móvil proveniente de Internet, totalmente ajeno a nuestra red de casa, la URL será \textit{37.134.69.14:8000/tuerasmus}. Esta IP es la IP pública de nuestra conexión a Internet. Para abrir este puerto a Internet se contactó con la compañía telefónica, indicándoles que abriesen dicho puerto al exterior. En la figura \textbf{\ref{fig:navIPprivada}} vemos la respuesta del servidor a la petición GET que realiza el navegador.\\

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/navIPprivada.png}
	\caption{Navegador realizando una petición GET de ``TuErasmus'' al servidor.}
	\label{fig:navIPprivada}
	
\end{figure}

El servidor se mantuvo lanzado unas dos semanas, para que los usuarios pudiesen probar la aplicación y notificarme de los \emph{bugs} que iban obteniendo durante este periodo de pruebas. Además de reportarme los \emph{bugs} que iban encontrando, fue bastante valioso el \emph{feedback} acerca de la funcionalidad de la aplicación y de posibles mejoras que se podrían aplicar, de las cuáles bastantes se han aplicado al resultado final de la aplicación.\\

\subsection{Alojamiento web}
Como último y definitivo método de despliegue se hizo uso de \emph{hosting}. Se eligió la web de \textbf{Alwaysdata}, que permite el despliegue de aplicaciones web implementadas en \textit{Django} (\textit{Python}), para no tener que hacer ninguna instalación. El servidor que tiene integrado es \textit{Apache}.\\

En primer lugar tenía que crear una cuenta en la plataforma de Alwaysdata, para poder subir mi proyecto y lanzar de esta manera la aplicación. En la figura \textbf{\ref{fig:cuentaAlwaysdata}} se muestra cómo es la interfaz de usuario de esta web.

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/cuentaAlwaysdata.png}
	\caption{Interfaz de usuario de la cuenta creada en la web de Alwaysdata.}
	\label{fig:cuentaAlwaysdata}
	
\end{figure}

Para conseguir un despliegue exitoso, fue necesario conectar mediante conexión \texttt{ssh} desde una \textit{shell Unix} a la cuenta con la que se realizó el despliegue, ejecutando la siguiente línea: \textit{ssh pfctuerasmus@ssh.alwaysdata.com}. De esta manera nos conectamos al directorio home de nuestra cuenta donde deberemos copiar mediante \texttt{scp} un fichero \texttt{zip} que contenga nuestro proyecto completo Django: \textit{scp mypfc.zip pfctuerasmus@ssh.alwaysdata.com: /\/home/\/pfctuerasmus/\/mypfc}. En la figura inferior \textbf{\ref{fig:cuentasshAlwaysdata}} se muestra esta conexión \texttt{ssh}.\\

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/sshAlwaysdata.png}
	\caption{Conexión ssh a Alwaysdata.}
	\label{fig:cuentasshAlwaysdata}
	
\end{figure}

Una vez copiado el \texttt{zip}, debemos descomprimir y realizar unas modificaciones en el directorio que acabamos de copiar del proyecto Django. Cuando tengamos descomprimido el fichero .zip, debemos navegar en nuestro proyecto y situarnos en el directorio raíz del proyecto (directorio donde se encuentre el fichero \textit{manage.py}) y crearemos una carpeta llamada \textit{public}, en la que crearemos dos fichero: \textit{django.fcgi} y \textit{.htaccess} que nos permitirán mantener lanzada nuestra aplicación y poder acceder y navegar por ella en cualquier momento. Debería quedar tal como se muestra en al figura \textbf{\ref{fig:dirAlwaysdata}}.\\

\begin{figure}[htbp]
	
	\centering
	\includegraphics[scale=0.5]{./Figuras/despliegue/directorioHomeAlwaysdata.png}
	\caption{Directorio de la cuenta de Alwaysdata donde encontramos los ficheros y directorio que forman nuestro proyecto Django.}
	\label{fig:dirAlwaysdata}
	
\end{figure}

Además de estos dos ficheros, debemos crear un enlace simbólico, para permitir el acceso del admin de Django desde la web de Alwaysdata, y que esta interfaz del admin coja los ficheros estáticos de estilo de donde corresponde.\\

Y con esto se completó el ciclo de las configuraciones para conseguir que la aplicación esté corriendo debidamente desde el \emph{hosting}.\\

\section{Resultados de las pruebas}
\label{SEC:Seccion42}
Una vez desplegada la aplicación, con el segundo método (IP pública), la reacción de los usuarios fue positiva, pero no tanto como se esperó. Por lo que tuvimos que realizar una serie de mejoras para motivar el uso de la aplicación web y que los usuarios quedasen satisfechos con los resultados.\\

Con el segundo despliegue masivo (alojamiento web) la usabilidad de la aplicación quedó mucho más clara y mejor definida. Con lo que los resultados de este segundo despliegue se acercan más a lo deseado. Como todo periodo de pruebas siempre surgen \emph{bugs} que se fueron mitigando a medida que fueron apareciendo.\\

Por tanto, quedamos satisfechos con los resultados obtenidos. Y tras estas pruebas, el \emph{feedback} de los usuarios ha sido bastante constructivo ya que se han abierto de esta manera futuras líneas para seguir trabajando en dicho proyecto.\\

Como último apartado de este despliegue, se envió a todos los usuarios una encuesta para valorar constructivamente la aplicación web. En el siguiente enlace se pueden observar las preguntas y respuestas obtenidas \textit{\nameref{apendice:encuesta}}. 

\section{Problemas encontrados}
\label{SEC:Seccion43}
Como problemas encontrados en el despliegue de la aplicación, se ha de mencionar la ausencia de motivación que ofrecía la aplicación. Por lo que no se consiguió una total satisfacción en cuanto a las pruebas que se deseaban desde un principio.\\

Uno de los \emph{bugs} que primero surgieron con el segundo método de despliegue (\emph{hosting}) fueron los ficheros estáticos de la aplicación. El \emph{path} de cada fichero de estilo no era el correcto y por tanto cuando accedías a las páginas de la aplicación estas eran mostradas con un aspecto nada similar a lo diseñado.\\

Una mejora realizada, resultante de este método de despliegue, fue aprovechar el cacheo de los ficheros de Javascript (jquery.js) usados en el código donde se integraban los mapas de \textit{Google Maps} para la localización de las universidades y de las residencias. Esto mejoraría el rendimiento de la aplicación web, ya que se evitó tener estos ficheros en local y se pedían directamente desde Internet, con lo que si están con anterioridad cacheados ahorramos tiempo y espacio.\\

Además de estos dos problemas mencionados en las líneas superiores, se tuvo que solucionar otro problema relacionado con la configuración de la aplicación, ya que constantemente aparecía el mensaje de error \texttt{500: Internal Server Error}, cuya razón era la configuración errónea de la cuenta creada para el despliegue en Alwaysdata.\\

